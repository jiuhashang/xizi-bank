{"remainingRequest":"C:\\Users\\ylf\\Desktop\\xizi - bank\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\ylf\\Desktop\\xizi - bank\\src\\views\\data\\launch\\index.vue?vue&type=style&index=0&id=0b112cde&lang=scss&scoped=true&","dependencies":[{"path":"C:\\Users\\ylf\\Desktop\\xizi - bank\\src\\views\\data\\launch\\index.vue","mtime":1644990171980},{"path":"C:\\Users\\ylf\\Desktop\\xizi - bank\\node_modules\\css-loader\\dist\\cjs.js","mtime":1668673146952},{"path":"C:\\Users\\ylf\\Desktop\\xizi - bank\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1668673148673},{"path":"C:\\Users\\ylf\\Desktop\\xizi - bank\\node_modules\\postcss-loader\\src\\index.js","mtime":1668673147587},{"path":"C:\\Users\\ylf\\Desktop\\xizi - bank\\node_modules\\sass-loader\\dist\\cjs.js","mtime":1668673148073},{"path":"C:\\Users\\ylf\\Desktop\\xizi - bank\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1668673146435},{"path":"C:\\Users\\ylf\\Desktop\\xizi - bank\\node_modules\\vue-loader\\lib\\index.js","mtime":1668673148087}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ci5zaGFuZyB7CiAgaGVpZ2h0OiA5N3B4OwogIGJhY2tncm91bmQtY29sb3I6ICNmZmY7CiAgLmVsLWJyZWFkY3J1bWIgewogICAgcGFkZGluZzogMTVweCAwIDAgMjVweDsKICB9CiAgaDIgewogICAgdGV4dC1hbGlnbjogbGVmdDsKICAgIHBhZGRpbmctbGVmdDogMjVweDsKICB9Cn0KLmVsLWFsZXJ0IHsKICBtYXJnaW4tYm90dG9tOiAyNXB4Owp9Ci5kaXZ1bCB7CiAgbWF4LXdpZHRoOiA2MDBweDsKICBtaW4td2lkdGg6IDM1MHB4OwogIGxpc3Qtc3R5bGU6IG5vbmU7CiAgYmFja2dyb3VuZC1jb2xvcjogI2ZmZjsKICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgdG9wOiAxNzBweDsKICBsZWZ0OiAxNTNweDsKICBib3JkZXI6MXB4IHNvbGlkICNEQ0RGRTY7CiAgYm9yZGVyLXJhZGl1czogNXB4OwogIG92ZXJmbG93OiBhdXRvOwp9Ci5kaXZsaSB7CiAgbWFyZ2luLWJvdHRvbTogMTBweDsKICBjdXJzb3I6IHBvaW50ZXI7CiAgd2lkdGg6IDEwMCU7Cn0KLmJnYzpob3ZlciB7CiAgY29sb3I6IGJsdWU7Cn0K"},{"version":3,"sources":["index.vue"],"names":[],"mappings":";AA4WA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/views/data/launch","sourcesContent":["<template>\n  <div>\n    <div class=\"shang\">\n      <el-breadcrumb separator=\"/\">\n        <el-breadcrumb-item :to=\"{ path: '/' }\">首页</el-breadcrumb-item>\n        <el-breadcrumb-item>资料收集</el-breadcrumb-item>\n        <el-breadcrumb-item>{{ $route.meta.title }}</el-breadcrumb-item>\n      </el-breadcrumb>\n      <h2>{{ $route.meta.title }}</h2>\n    </div>\n    <el-card>\n      <div style=\"display:flex;justify-content:space-between;\">\n        <el-form ref=\"ruleForm\" :model=\"tableInfo\" inline>\n          <el-form-item>\n            <el-input v-model=\"tableInfo.projectName\" placeholder=\"项目名称查询\" clearable style=\"width:250px;\" />\n          </el-form-item>\n          <el-form-item>\n            <el-input v-model=\"tableInfo.companyName\" placeholder=\"业主名称查询\" clearable style=\"width:250px;\" />\n          </el-form-item>\n          <el-form-item>\n            <el-select v-model=\"tableInfo.setProjectStatus\" clearable placeholder=\"全部状态\">\n              <el-option label=\"未完善\" :value=\"0\"></el-option>\n              <el-option label=\"已完善\" :value=\"1\"></el-option>\n            </el-select>\n          </el-form-item>\n          <el-form-item>\n            <el-select v-model=\"tableInfo.firstExamine\" clearable placeholder=\"全部进度\">\n              <el-option\n                v-for=\"item in option\"\n                :key=\"item.firstExamine\"\n                :label=\"item.label\"\n                :value=\"item.firstExamine\">\n              </el-option>\n            </el-select>\n           </el-form-item>\n          <el-form-item style=\"margin-left: 20px;\">\n            <el-button type=\"primary\" @click=\"handleQuery\">查询</el-button>\n            <el-button @click=\"reset\">重置</el-button>\n          </el-form-item>\n        </el-form>\n        <div>\n          <el-button type=\"primary\" @click=\"create\">创建项目表单</el-button>\n        </div>\n      </div>\n      <el-table :data=\"tableData\" stripe :header-cell-style=\"{background:'#eef1f6',color:'#606266'}\" style=\"width: 100%\">\n        <el-table-column prop=\"projectName\" label=\"项目名称\" />\n        <el-table-column prop=\"companyName\" label=\"业主名称\" />\n        <el-table-column prop=\"createTime\" label=\"创建时间\" />\n        <el-table-column label=\"建站地址\">\n          <template slot-scope=\"scope\">\n            {{scope.row.province}} - {{scope.row.city}}\n          </template>\n        </el-table-column>\n        <el-table-column label=\"发起进度\">\n          <template slot-scope=\"scope\">\n            <span v-if=\"scope.row.companyInfoStatus == 1 && scope.row.companyBuildStatus == 1 && scope.row.cooperateStatus == 1 && scope.row.powerStatus == 1 && scope.row.relevantStatus == 1\" style=\"color:#70B603;\">已完善</span>\n            <span v-else>未完善</span>\n          </template>\n        </el-table-column>\n        <el-table-column label=\"审批状态\">\n          <template slot-scope=\"scope\">\n            <span v-if=\"scope.row.firstExamine == 0\">待提交</span>\n            <span v-else-if=\"scope.row.firstExamine == 1\" style=\"color:#F59A23;\">审核中</span>\n            <span v-else-if=\"scope.row.firstExamine == 3\" style=\"color:#1890FF;\">初审通过</span>\n            <span v-else-if=\"scope.row.firstExamine == 2\" style=\"color:#D9001B;\">初审未通过</span>\n            <span v-else-if=\"scope.row.firstExamine == 99\">项目已终止</span>\n          </template>\n        </el-table-column>\n        <el-table-column label=\"操作\">\n          <template slot-scope=\"scope\">\n            <el-button type=\"text\" @click=\"handleView(scope.row)\">查看</el-button>\n            <el-button type=\"text\" @click=\"approval(scope.row.projectId)\">审批记录</el-button>\n          </template>\n        </el-table-column> \n      </el-table>\n      <c-pagination ref=\"pagination\" :total=\"total\" @sendsize=\"handleSizeChange\" @sendpage=\"handleCurrentChange\" />\n    </el-card>\n    <!-- 创建项目表单 -->\n    <el-dialog\n      title=\"创建项目表单\"\n      :visible.sync=\"dialogVisible\"\n      width=\"40%\"\n      :close-on-click-modal=\"false\"\n      @close=\"colseDialog\">\n      <div style=\"position: relative;\">\n        <el-alert\n          title=\"请在搜索结果中选择匹配的公司名称，且创建表单后将无法修改，请认真核对 !\"\n          type=\"success\"\n          :closable=\"false\">\n        </el-alert>\n        <el-form :model=\"ruleForm\" :rules=\"rules\" ref=\"ruleForm\" label-width=\"80px\" style=\"width:80%;margin:auto;\">\n          <el-form-item label=\"项目名称\" prop=\"projectName\">\n            <el-input v-model=\"ruleForm.projectName\" placeholder=\"请输入\" clearable />\n          </el-form-item>\n          <el-form-item label=\"公司名称\" prop=\"companyName\">\n            <el-input v-model.trim=\"ruleForm.companyName\" placeholder=\"请输入\" clearable @input=\"handleInput\" @clear=\"handleClear\" />\n          </el-form-item>\n        </el-form>\n        <div class=\"divul\" v-show=\"options.length\">\n          <ul v-show=\"options.length\" style=\"list-style: none;\">\n            <li v-for=\"(item, index) in options\" :key=\"item.id\" class=\"divli\" :class=\"{ bgc: index === currentIndex }\" @click=\"handleSelect(item, index)\" @mousemove=\"handleMove(index)\">{{ item.name }}</li>\n          </ul>\n        </div>\n      </div>\n      <span slot=\"footer\" class=\"dialog-footer\">\n        <el-button @click=\"dialogVisible = false\">取 消</el-button>\n        <el-button type=\"primary\" @click=\"createProject\" :loading=\"loading\">创 建</el-button>\n      </span>\n    </el-dialog>\n    <!-- 审批记录 -->\n    <ApprovalLog :logVisible.sync=\"logVisible\" :activities=\"activities\" />\n  </div>\n</template>\n\n<script>\nimport { getList, addOne, getCompanyInfoList, getProjectExamineLog } from '@/api/listProject'\n\nimport ApprovalLog from '@/components/Log/ApprovalLog.vue'\n\nexport default {\n  name: 'Launch',\n  data() {\n    return {\n      tableInfo: {\n        companyName: '',\n        projectName: '',\n        firstExamine: '',\n        type: 0,\n        setProjectStatus: '',\n        pageIndex: 1,\n        pageSize: 10\n      },\n      option: [\n        {\n          firstExamine: '0',\n          label: '待提交'\n        }, \n        {\n          firstExamine: '1',\n          label: '审核中'\n        }, \n        {\n          firstExamine: '3',\n          label: '审核通过'\n        }, \n        {\n          firstExamine: '2',\n          label: '审核未通过'\n        }, \n        {\n          firstExamine: '99',\n          label: '项目已终止'\n        }\n      ],\n      tableData: [],\n      total: 0,\n\n      // 创建项目表单\n      dialogVisible: false,\n      options: [], // 搜索公司列表\n      optionss: [], //\n      ruleForm: {\n        projectName: '',\n        companyName: '',\n        legalPerson: '',\n        registerMoney: '',\n        sameCreditCode: ''\n      },\n      rules: {\n        projectName: [\n            { required: true, message: '请输入项目名称', trigger: 'blur' },\n            { min: 4, max: 50, message: '长度在 4 到 50 个字符', trigger: 'blur' }\n          ],\n        companyName: [\n          { required: true, message: '请输入公司名称', trigger: 'blur' },\n          { min: 6, max: 50, message: '长度在 6 到 50 个字符', trigger: 'blur' }\n        ]\n      },\n      currentIndex: null,\n      loading: false,\n\n      // 审批记录\n      logVisible: false,\n      activities: []\n    }\n  },\n  components: { ApprovalLog },\n  created() {\n    this.getList()\n  },\n  methods: {\n    // 列表请求\n    getList() {\n      getList(this.tableInfo).then(res => {\n        const { records, total } = res.data\n        this.tableData = records\n        this.total = total\n      })\n    },\n    // 表dan查询\n    handleQuery() {\n      this.tableInfo.pageIndex = 1\n      this.$refs.pagination.resetOption(this.tableInfo.pageIndex, this.tableInfo.pageSize)\n      this.getList()\n    },\n    // 表dan重置\n    reset() {\n      this.tableInfo = {\n        companyName: '',\n        projectName: '',\n        firstExamine: '',\n        setProjectStatus: '',\n        type: 0,\n        pageIndex: 1,\n        pageSize: 10\n      }\n      this.$refs.pagination.resetOption(this.tableInfo.pageIndex, this.tableInfo.pageSize)\n      this.getList()\n    },\n\n    // 查看详情\n    handleView(row) {\n      this.$router.push({ name: 'LaunchDetail', query: { \n          projectId: row.projectId,\n          createTime: row.createTime,\n          createUserNickName: row.createUserNickName,\n          createUserPhone: row.createUserPhone,\n          projectName: row.projectName,\n          companyName: row.companyName,\n          firstExamine: row.firstExamine\n        }\n      })\n    },\n    \n    // 审批记录\n    approval(projectId) {\n      getProjectExamineLog({projectId}).then(res => {\n        this.activities = res.data\n      })\n      this.logVisible = true\n    },\n\n    handleSizeChange(val) {\n      this.tableInfo.pageSize = val\n      this.getList()\n    },\n    handleCurrentChange(val) {\n      this.tableInfo.pageIndex = val\n      this.getList()\n    },\n\n    // 创建项目表\n    create() {\n      this.dialogVisible = true\n    },\n    handleInput() {\n      if( this.ruleForm.companyName.length > 5 ) {\n        setTimeout(() => {\n          getCompanyInfoList(this.ruleForm).then(res => {\n            this.options = res.data\n            this.optionss = res.data\n          })\n        }, 300)\n      } else {\n        this.options = []\n        this.optionss = []\n      }\n    },\n    handleSelect(item) {\n      this.ruleForm.companyName = item.name\n      this.ruleForm.legalPerson = item.legalPersonName\n      this.ruleForm.registerMoney = item.regCapital\n      this.ruleForm.sameCreditCode = item.creditCode\n      this.options = []\n    },\n    colseDialog() {\n      this.ruleForm = {\n        projectName: '',\n        companyName: '',\n        legalPerson: '',\n        registerMoney: '',\n        sameCreditCode: ''\n      }\n      this.options = []\n      this.optionss = []\n    },\n    handleClear() {\n      this.ruleForm.companyName = ''\n      this.options = []\n    },\n    handleMove(index) {\n      this.currentIndex = index\n    },\n    createProject() { // 创建项目\n      this.loading = true\n      const result = this.optionss.find(item => {\n        return item.name === this.ruleForm.companyName\n      })\n      if(result == undefined) {\n        this.$message.error('必须选择一项才能进行下一步操作')\n        this.loading = false\n        return\n      } else {\n        this.$refs.ruleForm.validate(valid => {\n          if(valid) {\n            addOne(this.ruleForm).then(res => {\n              this.loading = false\n              this.$message.success('创建项目表单成功')\n              this.$router.push({ name: 'LaunchDetail', query: { \n                projectId: res.data.projectId,\n                createTime: res.data.createTime,\n                createUserNickName: res.data.createUserNickName,\n                createUserPhone: res.data.createUserPhone,\n                projectName: res.data.projectName,\n                companyName: res.data.companyName\n                }\n              })\n            }).catch(err => {\n              this.loading = false\n            })\n          }\n        })\n      }\n    }\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n  .shang {\n    height: 97px;\n    background-color: #fff;\n    .el-breadcrumb {\n      padding: 15px 0 0 25px;\n    }\n    h2 {\n      text-align: left;\n      padding-left: 25px;\n    }\n  }\n  .el-alert {\n    margin-bottom: 25px;\n  }\n  .divul {\n    max-width: 600px;\n    min-width: 350px;\n    list-style: none;\n    background-color: #fff;\n    position: absolute;\n    top: 170px;\n    left: 153px;\n    border:1px solid #DCDFE6;\n    border-radius: 5px;\n    overflow: auto;\n  }\n  .divli {\n    margin-bottom: 10px;\n    cursor: pointer;\n    width: 100%;\n  }\n  .bgc:hover {\n    color: blue;\n  }\n</style>"]}]}