{"remainingRequest":"C:\\Users\\ylf\\Desktop\\xizi - bank\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\ylf\\Desktop\\xizi - bank\\src\\views\\center\\share\\shareDetail\\index.vue?vue&type=style&index=0&id=7e357943&lang=scss&scoped=true&","dependencies":[{"path":"C:\\Users\\ylf\\Desktop\\xizi - bank\\src\\views\\center\\share\\shareDetail\\index.vue","mtime":1645494517297},{"path":"C:\\Users\\ylf\\Desktop\\xizi - bank\\node_modules\\css-loader\\dist\\cjs.js","mtime":1668673146952},{"path":"C:\\Users\\ylf\\Desktop\\xizi - bank\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1668673148673},{"path":"C:\\Users\\ylf\\Desktop\\xizi - bank\\node_modules\\postcss-loader\\src\\index.js","mtime":1668673147587},{"path":"C:\\Users\\ylf\\Desktop\\xizi - bank\\node_modules\\sass-loader\\dist\\cjs.js","mtime":1668673148073},{"path":"C:\\Users\\ylf\\Desktop\\xizi - bank\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1668673146435},{"path":"C:\\Users\\ylf\\Desktop\\xizi - bank\\node_modules\\vue-loader\\lib\\index.js","mtime":1668673148087}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQouc2hhbmcgew0KICBoZWlnaHQ6IDk3cHg7DQogIGJhY2tncm91bmQtY29sb3I6ICNmZmY7DQogIC5lbC1icmVhZGNydW1iIHsNCiAgICBwYWRkaW5nOiAxNXB4IDAgMCAyNXB4Ow0KICB9DQogIC5iYWNrIHsNCiAgICBwb3NpdGlvbjogcmVsYXRpdmU7DQogICAgLmJ0bm5uIHsNCiAgICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsNCiAgICAgIGJvdHRvbTogMDsNCiAgICAgIHJpZ2h0OiAxNXB4Ow0KICAgIH0NCiAgfQ0KICBoMiB7DQogICAgcGFkZGluZy1sZWZ0OiAyNXB4Ow0KICAgIGN1cnNvcjogcG9pbnRlcjsNCiAgfQ0KfQ0KDQoueGlhbiB7DQogIGNvbG9yOiAjMTg5MGZmOw0KICBib3JkZXItYm90dG9tOiAxcHggc29saWQgIzE4OTBmZjsNCiAgcGFkZGluZy1ib3R0b206IDVweDsNCiAgZGl2IHsNCiAgICBib3JkZXItbGVmdDogNHB4IHNvbGlkICMxODkwZmY7DQogICAgcGFkZGluZy1sZWZ0OiAxNXB4Ow0KICB9DQp9DQouc3BhbjEzIHsNCiAgICBmb250LXNpemU6IDEzcHg7DQogICAgY29sb3I6ICNhYWE7DQogICAgdGV4dC1hbGlnbjogcmlnaHQ7DQogIH0NCi5zcGFuMTMwIHsNCiAgZm9udC1zaXplOiAxM3B4Ow0KICBjb2xvcjogIzAwMDsNCn0NCg=="},{"version":3,"sources":["index.vue"],"names":[],"mappings":";AA4SA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/views/center/share/shareDetail","sourcesContent":["<template>\r\n  <div>\r\n    <div class=\"shang\">\r\n      <el-breadcrumb separator=\"/\">\r\n        <el-breadcrumb-item :to=\"{ path: '/' }\">首页</el-breadcrumb-item>\r\n        <el-breadcrumb-item>审批中心</el-breadcrumb-item>\r\n        <el-breadcrumb-item>{{ $route.meta.title }}</el-breadcrumb-item>\r\n      </el-breadcrumb>\r\n      <div class=\"back\">\r\n        <div @click=\"$router.back()\" style=\"width: 240px\">\r\n          <h2>&lt; {{ $route.meta.title }}</h2>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    <el-card>\r\n      <div class=\"xian\">\r\n        <div>项目信息</div>\r\n      </div>\r\n      <el-row :gutter=\"20\" style=\"margin: 30px\">\r\n        <el-col :span=\"8\">\r\n          <el-row :gutter=\"20\">\r\n            <el-col :span=\"8\" class=\"span13\">创建时间</el-col>\r\n            <el-col :span=\"16\" class=\"span130\">{{$route.query.createTime}}</el-col>\r\n          </el-row>\r\n        </el-col>\r\n        <el-col :span=\"8\">\r\n          <el-row :gutter=\"20\">\r\n            <el-col :span=\"8\" class=\"span13\">负责人</el-col>\r\n            <el-col :span=\"16\" class=\"span130\">{{$route.query.createUserNickName}}</el-col>\r\n          </el-row>\r\n        </el-col>\r\n        <el-col :span=\"8\">\r\n          <el-row :gutter=\"20\">\r\n            <el-col :span=\"8\" class=\"span13\">负责人电话</el-col>\r\n            <el-col :span=\"16\" class=\"span130\">{{$route.query.createUserPhone}}</el-col>\r\n          </el-row>\r\n        </el-col>\r\n      </el-row>\r\n      <el-row :gutter=\"20\" style=\"margin: 30px\">\r\n        <el-col :span=\"8\">\r\n          <el-row :gutter=\"20\">\r\n            <el-col :span=\"8\" class=\"span13\">项目名称</el-col>\r\n            <el-col :span=\"16\" class=\"span130\">{{$route.query.projectName}}</el-col>\r\n          </el-row>\r\n        </el-col>\r\n        <el-col :span=\"8\">\r\n          <el-row :gutter=\"20\">\r\n            <el-col :span=\"8\" class=\"span13\">公司名称</el-col>\r\n            <el-col :span=\"16\" class=\"span130\">{{$route.query.companyName}}</el-col>\r\n          </el-row>\r\n        </el-col>\r\n      </el-row>\r\n\r\n      <div class=\"xian\">\r\n        <div>分享情况</div>\r\n      </div>\r\n      <div style=\"margin-top: 15px;text-align:right;\">\r\n        <el-button size=\"small\" @click=\"handleRemoveAll\">全部移除</el-button>\r\n        <el-button type=\"primary\" size=\"small\" @click=\"handleAdd\">添加机构</el-button>\r\n      </div>\r\n      <el-table :data=\"tableData\" style=\"width: 100%\" :header-cell-style=\"{background:'#f2f2f2',color:'#555'}\">\r\n        <el-table-column prop=\"bankName\" label=\"机构名称\" />\r\n        <el-table-column prop=\"expireTime\" label=\"分享自动失效时间\" />\r\n        <el-table-column label=\"分享状态\">\r\n          <template slot-scope=\"scope\">\r\n            <span v-if=\"scope.row.expireFlag == 0\">分享中</span>\r\n            <span v-else-if=\"scope.row.expireFlag == 1\">已失效</span>\r\n            <span v-else> - </span>\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column label=\"文件下载权限\">\r\n          <template slot-scope=\"scope\">\r\n            <span v-show=\"scope.row.downFlag == 0\">未开通</span>\r\n            <span v-show=\"scope.row.downFlag == 1\">已开通</span>\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column label=\"其他\">\r\n          <template slot-scope=\"scope\">\r\n            <el-button type=\"text\" @click=\"handlePermission(scope.row)\">权限管理</el-button>\r\n            <el-button type=\"text\" @click=\"handleExtend(scope.row)\">延长时间</el-button>\r\n            <el-button type=\"text\" style=\"color:red;\" @click=\"handleRemove(scope.row)\">移除分享</el-button>\r\n          </template>\r\n        </el-table-column>\r\n      </el-table>\r\n    </el-card>\r\n    <el-dialog\r\n      title=\"添加机构\"\r\n      :visible.sync=\"addDialogVisible\"\r\n      :close-on-click-modal=\"false\"\r\n      @close=\"handleClose\"\r\n      width=\"40%\">\r\n       <el-table :data=\"addTableData\" style=\"width: 100%\" :header-cell-style=\"{background:'#f2f2f2',color:'#555'}\">\r\n         <el-table-column label=\"\" width=\"40\">\r\n          <template scope=\"scope\">\r\n            <el-radio\r\n              :label=\"scope.$index\"\r\n              v-model=\"currentRow\"\r\n              @change.native=\"getCurrentRow(scope.row)\"\r\n              style=\"color: #fff; padding-left: 10px; margin-right: -25px\"\r\n            ></el-radio>\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column prop=\"bankName\" label=\"机构名称\" />\r\n        <el-table-column prop=\"contactName\" label=\"联系人\" />\r\n      </el-table>\r\n      <c-pagination ref=\"pagination\" :total=\"total\" @sendsize=\"handleSizeChange\" @sendpage=\"handleCurrentChange\" />\r\n      <span slot=\"footer\" class=\"dialog-footer\">\r\n        <el-button @click=\"addDialogVisible = false\">取 消</el-button>\r\n        <el-button type=\"primary\" @click=\"handleAddBank\">确 定</el-button>\r\n      </span>\r\n    </el-dialog>\r\n    <el-dialog\r\n      title=\"分享权限\"\r\n      :visible.sync=\"shareDialogVisible\"\r\n      :close-on-click-modal=\"false\"\r\n      width=\"30%\">\r\n      <div style=\"text-align: center;\">\r\n        <el-checkbox checked disabled style=\"padding-right:50px;\">查看</el-checkbox>\r\n        <el-checkbox v-model=\"checked\" @change=\"handleChange\">文件下载</el-checkbox>\r\n      </div>\r\n      <span slot=\"footer\" class=\"dialog-footer\">\r\n        <el-button @click=\"shareDialogVisible = false\">取 消</el-button>\r\n        <el-button type=\"primary\" @click=\"handleAddShare\">确 定</el-button>\r\n      </span>\r\n    </el-dialog>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { getShareBankList, getBank, shareBankProject, deleteShare, editOne } from '@/api/integrated'\r\nexport default {\r\n  name: 'ShareDetail',\r\n  data() {\r\n    return {\r\n      listInfo: {\r\n        projectId: this.$route.query.projectId,\r\n        pageIndex: 1,\r\n        pageSize: 10\r\n      },\r\n      tableData: [],\r\n\r\n      addDialogVisible: false,\r\n      addTableData: [],\r\n      total: 0,\r\n      shareInfo: {\r\n        projectId: this.$route.query.projectId,\r\n        seBankUserList: [],\r\n        downFlag: 0\r\n      },\r\n\r\n      shareDialogVisible: false,\r\n      checked: false,\r\n      shareQuery: {\r\n        type: 1, \r\n        id: undefined,\r\n        downFlag: undefined\r\n      },\r\n\r\n      currentRow: undefined,\r\n      bankName: ''\r\n    }\r\n  },\r\n  created() {\r\n    this.getShareBankList()\r\n  },\r\n  methods: {\r\n    getShareBankList() {\r\n      getShareBankList(this.listInfo).then(res => {\r\n        this.tableData = res.data.records\r\n      })\r\n    },\r\n    handleAdd() {\r\n      this.getBank()\r\n      this.addDialogVisible = true\r\n    },\r\n    getCurrentRow(row) {\r\n      this.bankName = row.bankName\r\n      this.shareInfo.seBankUserList.push(row)\r\n    },\r\n    async handleAddBank() {\r\n      if(this.shareInfo.seBankUserList.length < 1) { return this.$message.warning('请选择您要分享的机构') }\r\n      const confirmResult = await this.$confirm(`是否对 ${this.bankName} 机构进行分享?`, '提示', {\r\n        confirmButtonText: '确定',\r\n        cancelButtonText: '取消',\r\n        type: 'warning'\r\n      }).catch((err) => err)\r\n      if (confirmResult !== 'confirm') {\r\n        return this.$message.info('已取消')\r\n      }\r\n      this.addDialogVisible = false\r\n      shareBankProject(this.shareInfo).then(res => {\r\n        console.log(res)\r\n        this.$message.success(res.msg)\r\n        this.getShareBankList()\r\n      }).catch(err => {\r\n        this.addDialogVisible = false\r\n      })\r\n    },\r\n    async handleRemove(row) {\r\n      const confirmResult = await this.$confirm(`是否移除 ${row.bankName} 机构?`, '提示', {\r\n        confirmButtonText: '确定',\r\n        cancelButtonText: '取消',\r\n        type: 'warning'\r\n      }).catch((err) => err)\r\n      if (confirmResult !== 'confirm') {\r\n        return this.$message.info('已取消')\r\n      }\r\n      deleteShare({\r\n        id: row.id,\r\n        projectId: row.projectId,\r\n        type: 0\r\n      }).then(res => {\r\n        this.getShareBankList()\r\n        this.$message.success(res.msg)\r\n      })\r\n    },\r\n    async handleRemoveAll() {\r\n      if(this.tableData.length < 1) { return this.$message.warning('当前暂无分享情况，请添加机构') }\r\n      const confirmResult = await this.$confirm('是否全部移除机构?', '提示', {\r\n        confirmButtonText: '确定',\r\n        cancelButtonText: '取消',\r\n        type: 'warning'\r\n      }).catch((err) => err)\r\n      if (confirmResult !== 'confirm') {\r\n        return this.$message.info('已取消')\r\n      }\r\n      deleteShare({\r\n        projectId: this.$route.query.projectId,\r\n        type: 1\r\n      }).then(res => {\r\n        this.getShareBankList()\r\n        this.$message.success(res.msg)\r\n      })\r\n    },\r\n    async handleExtend(row) {\r\n      const confirmResult = await this.$confirm(`是否延长 ${row.bankName} 机构的分享时间15天?`, '提示', {\r\n        confirmButtonText: '确定',\r\n        cancelButtonText: '取消',\r\n        type: 'warning'\r\n      }).catch((err) => err)\r\n      if (confirmResult !== 'confirm') {\r\n        return this.$message.info('已取消')\r\n      }\r\n      editOne({\r\n        type: 0,\r\n        id: row.id\r\n      }).then(res => {\r\n        this.$message.success(res.msg)\r\n        this.getShareBankList()\r\n      })\r\n    },\r\n    handlePermission(row) {\r\n      this.shareDialogVisible = true\r\n      this.shareQuery.id = row.id\r\n      if( row.downFlag == 0 ) { \r\n        this.checked = false \r\n      } else if( row.downFlag == 1 ) {\r\n        this.checked = true\r\n      }\r\n    },\r\n    handleAddShare() {\r\n      editOne( this.shareQuery ).then(res => {\r\n        this.shareDialogVisible = false\r\n        this.$message.success(res.msg)\r\n        this.getShareBankList()\r\n      })\r\n    },\r\n    handleChange(val) {\r\n      if(val) {\r\n        this.shareQuery.downFlag = 1\r\n      } else {\r\n        this.shareQuery.downFlag = 0\r\n      }\r\n    },\r\n    handleClose() {\r\n      this.addTableData = []\r\n      this.currentRow = undefined\r\n      this.checked = false\r\n    },\r\n    getBank() {\r\n      getBank( this.listInfo ).then(res => {\r\n        this.addTableData = res.data.records\r\n      })\r\n    },\r\n\r\n    handleSizeChange(val) {\r\n      // console.log(`每页 ${val} 条`)\r\n      this.listInfo.pageSize = val\r\n      this.getBank()\r\n    },\r\n    handleCurrentChange(val) {\r\n      // console.log(`当前页: ${val}`)\r\n      this.listInfo.pageIndex = val\r\n      this.getBank()\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.shang {\r\n  height: 97px;\r\n  background-color: #fff;\r\n  .el-breadcrumb {\r\n    padding: 15px 0 0 25px;\r\n  }\r\n  .back {\r\n    position: relative;\r\n    .btnnn {\r\n      position: absolute;\r\n      bottom: 0;\r\n      right: 15px;\r\n    }\r\n  }\r\n  h2 {\r\n    padding-left: 25px;\r\n    cursor: pointer;\r\n  }\r\n}\r\n\r\n.xian {\r\n  color: #1890ff;\r\n  border-bottom: 1px solid #1890ff;\r\n  padding-bottom: 5px;\r\n  div {\r\n    border-left: 4px solid #1890ff;\r\n    padding-left: 15px;\r\n  }\r\n}\r\n.span13 {\r\n    font-size: 13px;\r\n    color: #aaa;\r\n    text-align: right;\r\n  }\r\n.span130 {\r\n  font-size: 13px;\r\n  color: #000;\r\n}\r\n</style>\r\n"]}]}